<UserControl x:Class="MVVM_Base.View.viewLinear"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:Icon="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:converter="clr-namespace:MVVM_Base.Common"
             xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
             Style="{StaticResource Page_Style}" Cursor=""
             xmlns:local="clr-namespace:MVVM_Base.Common"
             Loaded="UserControl_Loaded">

    <i:Interaction.Triggers>
        <i:EventTrigger EventName="PreviewKeyDown">
            <i:InvokeCommandAction Command="{Binding AdjustUICommand}" PassEventArgsToCommand="True" />
        </i:EventTrigger>
        <i:EventTrigger EventName="PreviewMouseWheel">
            <i:InvokeCommandAction Command="{Binding AdjustUICommand}" PassEventArgsToCommand="True" />
        </i:EventTrigger>
    </i:Interaction.Triggers>

    <UserControl.Resources>
        <converter:EnumToBooleanConverter x:Key="EnumToBooleanConverter" />
        <converter:InverseBoolConverter x:Key="InverseBoolConverter" />


        <Style x:Key="MeasureTextCenterStyle" TargetType="TextBlock">
            <Setter Property="FontSize" Value="{Binding DataContext.LogFontSize,
                                                    RelativeSource={RelativeSource AncestorType=ItemsControl}}"/>
            <Setter Property="HorizontalAlignment" Value="Center"/>
            <Setter Property="VerticalAlignment" Value="Center"/>
        </Style>

        <Style 
            x:Key="MeasureTextLeftStyle"
            TargetType="TextBlock"
            BasedOn="{StaticResource MeasureTextCenterStyle}">
            <Setter Property="HorizontalAlignment" Value="Left"/>
            <Setter Property="Margin" Value="4,0,0,0"/>
        </Style>

        <Style x:Key="MeasureTextBoxCenterStyle" TargetType="TextBox">
            <Setter Property="FontSize" Value="{Binding DataContext.LogFontSize,
                                                    RelativeSource={RelativeSource AncestorType=ItemsControl}}"/>
            <Setter Property="TextAlignment" Value="Center"/>
            <Setter Property="Margin" Value="0,0,0,0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="TextBox">
                        <Grid>
                            <!-- 背景（通常 = Transparent）-->
                            <Border 
                        x:Name="BgBorder"
                        Background="Transparent"
                        Padding="{TemplateBinding Padding}">
                                <ScrollViewer x:Name="PART_ContentHost"/>
                            </Border>
                        </Grid>

                        <!-- フォーカス時の色変更 -->
                        <ControlTemplate.Triggers>
                            <!-- TextBoxがフォーカス中 -->
                            <Trigger Property="IsKeyboardFocused" Value="True">
                                <!-- 背景色変更 -->
                                <Setter 
                            TargetName="BgBorder"
                            Property="Background"
                            Value="{DynamicResource ButtonThemeColorBrush2}" />
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="MeasureCellBorderStyle" TargetType="Border">
            <Setter Property="BorderBrush" Value="{DynamicResource ButtonThemeColorBrush}" />
            <Setter Property="BorderThickness" Value="1" />
            <Setter Property="Background" Value="Transparent" />

            <Style.Triggers>
                <!-- 1行目（AlternationIndex == 0） -->
                <DataTrigger 
                    Binding="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter},
                    Path=(ItemsControl.AlternationIndex)}"
                    Value="0">
                    <Setter Property="BorderBrush" Value="{DynamicResource ButtonThemeColorBrush2}" />
                </DataTrigger>
            </Style.Triggers>
        </Style>


        <Style x:Key="MeasureTextLeftStyle_WithFirstRowCenter"
               TargetType="TextBlock"               
               BasedOn="{StaticResource MeasureTextLeftStyle}">

            <!-- 通常は左 -->
            <Setter Property="HorizontalAlignment" Value="Center"/>

            <Style.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter},
                                       Path=(ItemsControl.AlternationIndex)}"
                     Value="0">
                    <Setter Property="HorizontalAlignment" Value="Center"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="MeasureTextBoxLeftStyle_WithFirstRowCenter"
                TargetType="TextBox"
                BasedOn="{StaticResource MeasureTextBoxCenterStyle}">

            <!-- 通常は左 -->
            <Setter Property="HorizontalAlignment" Value="Center"/>

            <Style.Triggers>
                <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter},
                                       Path=(ItemsControl.AlternationIndex)}"
                     Value="0">
                    <Setter Property="HorizontalAlignment" Value="Center"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <!-- Conf Aloneボタン -->
        <Style x:Key="ConfirmButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border"
                                Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource ButtonThemeColorBrush2}"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="LogGroupBoxStyle" TargetType="GroupBox">
            <Setter Property="Foreground" Value="{DynamicResource AccentBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
            <Setter Property="FontSize" Value="18"/>
            <Setter Property="FontWeight" Value="Bold"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="GroupBox">
                        <Border
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="1"
                            CornerRadius="5"
                            Background="Transparent"
                            SnapsToDevicePixels="True">

                            <Grid>
                                <Grid.RowDefinitions>
                                    <!-- Header -->
                                    <RowDefinition Height="Auto"/>
                                    <!-- Content -->
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Header -->
                                <ContentPresenter
                                    Grid.Row="0"
                                    ContentSource="Header"
                                    RecognizesAccessKey="True"
                                    Margin="5"
                                    ContentTemplate="{TemplateBinding HeaderTemplate}"/>

                                <!-- Content -->
                                <ContentPresenter
                                    Grid.Row="1"
                                    Margin="{TemplateBinding Padding}"/>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- 編集時 TextBox の背景色 -->
        <Style x:Key="EditingTextBoxStyle" TargetType="TextBox">
            <Setter Property="Background" Value="{DynamicResource ButtonThemeColorBrush2}" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="FontSize" Value="{Binding DataGridFontSize}" />
            <Setter Property="local:HexCheckAssist.Enable" Value="True"/>
        </Style>

        <!-- セル：背景透明＋上下左右に罫線 -->
        <Style x:Key="TransparentCell" TargetType="DataGridCell">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="{DynamicResource AccentBrush}" />
            <Setter Property="BorderThickness" Value="0" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridCell">
                        <Border 
                            x:Name="Bd"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{DynamicResource ButtonThemeColorBrush}"
                            
                            BorderThickness="1">
                            <!-- 四辺すべて -->
                            <ContentPresenter
                                Margin="0"
                                HorizontalAlignment="Center"
                                VerticalAlignment="Center"/>
                        </Border>

                        <ControlTemplate.Triggers>
                            <!-- 選択時 -->
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Bd"
                                Property="Background"
                                Value="{DynamicResource ButtonThemeColorBrush}" />
                                <!--<Setter Property="Foreground" Value="White"/>-->
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- カラムヘッダ：背景透明＋四辺罫線 -->
        <Style x:Key="TransparentColumnHeader" TargetType="DataGridColumnHeader">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource AccentBrush}" />
            <Setter Property="HorizontalContentAlignment" Value="Center"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridColumnHeader">
                        <Border 
                            x:Name="Hd"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{DynamicResource ButtonThemeColorBrush}"
                            BorderThickness="1">
                            <ContentPresenter 
                                Margin="0"
                                VerticalAlignment="Center"
                                HorizontalAlignment="Center"/>
                        </Border>

                        <ControlTemplate.Triggers>
                            <!-- ソート時の色変更を無効化したいならコメントで残す -->
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </UserControl.Resources>

    <!-- 全体Grid -->
    <Grid>
        <ScrollViewer
            x:Name="MyScrollViewer"
            HorizontalScrollBarVisibility="Auto"
            VerticalScrollBarVisibility="Auto"
            ScrollChanged="ScrollViewer_ScrollChanged"
            PreviewMouseUp="ScrollViewer_PreviewMouseUp"
            PreviewMouseDown="ScrollViewer_PreviewMouseDown"
            PreviewMouseMove="ScrollViewer_PreviewMouseMove"
            PreviewMouseWheel="ScrollViewer_PreviewMouseWheel" Cursor="">

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Grid Margin="0" Grid.Column="0">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- 最上段Grid s/h,流量,計測設定, FB -->
                    <Grid Grid.Row="0" HorizontalAlignment="Left" Margin="10 10 0 0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- 1段目Grid s/h,流量,計測設定 -->
                        <Grid Grid.Row="0" HorizontalAlignment="Left">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <!-- 通信状態 -->
                            <GroupBox Grid.Row="0" Grid.Column="0" Margin="5 0 0 0"
                                    Style="{StaticResource GroupBoxSmallMarginStyle}"                      
                                    Width="{Binding GroupBoxWidth90}">
                                <GroupBox.Header>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock 
                                        Text="Comm" 
                                        Foreground="{DynamicResource AccentBrush}" 
                                        FontSize="{Binding TitleFontSize}" 
                                        FontWeight="Bold"/>
                                    </StackPanel>
                                </GroupBox.Header>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <StackPanel
                                    Grid.Column="0"
                                    Orientation="Horizontal" 
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Margin="0 10 0 0">
                                        <Icon:PackIconMaterial 
                                        Kind="CameraRear"
                                        Width="{Binding IconSize}" 
                                        Height="{Binding IconSize}"
                                        VerticalAlignment="Center"
                                        Foreground="{DynamicResource AccentBrush}"/>

                                        <Icon:PackIconMaterial
                                        Kind="AccessPointNetwork"
                                        Width="{Binding IconSize}" 
                                        Height="{Binding IconSize}"
                                        Margin="10,0,0,0"
                                        VerticalAlignment="Center"
                                        Visibility="{Binding IsMfcPortSelected, Converter={StaticResource BoolToVisibilityConverter}}">
                                            <Icon:PackIconMaterial.Foreground>
                                                <LinearGradientBrush 
                                                StartPoint="0,0" 
                                                EndPoint="1,0">
                                                    <GradientStop 
                                                    x:Name="MfcCommIconColor" 
                                                    Color="{DynamicResource CommIconColorFrom}"
                                                    Offset="0"/>
                                                </LinearGradientBrush>
                                            </Icon:PackIconMaterial.Foreground>
                                        </Icon:PackIconMaterial>
                                    </StackPanel>

                                    <StackPanel 
                                    Grid.Row="1" 
                                    Orientation="Horizontal" 
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Margin="0 20 0 0">
                                        <Icon:PackIconMaterial 
                                        Kind="ScaleBalance"
                                        Width="{Binding IconSize}" 
                                        Height="{Binding IconSize}"
                                        VerticalAlignment="Center"
                                        Foreground="{DynamicResource AccentBrush}"/>

                                        <Icon:PackIconMaterial 
                                        Kind="AccessPointNetwork"
                                        Width="{Binding IconSize}" 
                                        Height="{Binding IconSize}"
                                        Margin="10,0,0,0"
                                        VerticalAlignment="Center"
                                        Visibility="{Binding IsBalancePortSelected, Converter={StaticResource BoolToVisibilityConverter}}" Cursor="">
                                            <Icon:PackIconMaterial.Foreground>
                                                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                                                    <GradientStop x:Name="BalanceCommIconColor" Color="{DynamicResource CommIconColorFrom}" Offset="0"/>
                                                </LinearGradientBrush>
                                            </Icon:PackIconMaterial.Foreground>
                                        </Icon:PackIconMaterial>
                                    </StackPanel>
                                </Grid>
                            </GroupBox>


                            <Grid Grid.Column="1">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <!-- ▼ S/Nグループ -->
                                <GroupBox Grid.Row="0" Grid.Column="1" Margin="5 0 0 10"
                                    Style="{StaticResource GroupBoxSmallMarginStyle}"                      
                                    Width="{Binding GroupBoxWidth100}">
                                    <GroupBox.Header>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock 
                                            Text="S/N" 
                                            Foreground="{DynamicResource AccentBrush}" 
                                            FontSize="{Binding TitleFontSize}" 
                                            FontWeight="Bold"/>
                                        </StackPanel>
                                    </GroupBox.Header>

                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Border 
                                        BorderBrush="{DynamicResource AccentBrush}"
                                        BorderThickness="0 0 0 1.5"
                                        SnapsToDevicePixels="True"
                                        Margin="5 0 5 5">
                                            <TextBlock 
                                            Text="{Binding SerialNum}"
                                            Foreground="{DynamicResource AccentBrush}"
                                            FontSize="{Binding TitleFontSize}"
                                            VerticalAlignment="Center"
                                            Margin="0 0 0 0"/>
                                        </Border>
                                    </Grid>
                                </GroupBox>

                                <!-- ▼ Flow グループ -->
                                <GroupBox Grid.Row="1" Grid.Column="1" Margin="5 0 0 0"
                                   Style="{StaticResource GroupBoxSmallMarginStyle}"                      
                                   Width="{Binding GroupBoxWidth100}">
                                    <GroupBox.Header>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock
                                            Text="Flow" 
                                            Foreground="{DynamicResource AccentBrush}" 
                                            FontSize="{Binding TitleFontSize}" 
                                            FontWeight="Bold"/>
                                        </StackPanel>
                                    </GroupBox.Header>

                                    <Grid>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>

                                        <TextBox 
                                        Style="{StaticResource UnderlineTextBoxStyle}" 
                                        Margin="0 -7 0 0"
                                        Text="{Binding FlowValue, UpdateSourceTrigger=PropertyChanged}"
                                        FontSize="{Binding TitleFontSize}"
                                        IsEnabled="{Binding FlowEnable}">
                                            <i:Interaction.Behaviors>
                                                <local:FpNumberBehavior MaxValue="100000" MinValue="0"/>
                                            </i:Interaction.Behaviors>
                                        </TextBox>
                                    </Grid>
                                </GroupBox>
                            </Grid>

                            <!-- その他設定 -->
                            <GroupBox Grid.Row="0" Grid.Column="2" Margin="5 0 0 0"
                                  Style="{StaticResource GroupBoxSmallMarginStyle}"                      
                                  Width="{Binding SmallGBWidth}">
                                <GroupBox.Header>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock 
                                        Text="Other Settings" 
                                        Foreground="{DynamicResource AccentBrush}" 
                                        FontSize="{Binding TitleFontSize}" 
                                        FontWeight="Bold"/>
                                    </StackPanel>
                                </GroupBox.Header>

                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>

                                    <!-- 上段左：Version -->
                                    <Grid Grid.Column="0" Margin="0 0 10 0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Label
                                            Grid.Row="0"
                                            Margin="0 10 0 0"
                                            Content="Version"
                                            Foreground="{DynamicResource AccentBrush}"
                                            FontSize="{Binding TitleFontSize}">
                                        </Label>
                                        <RadioButton 
                                            Grid.Row="1"
                                            Content="4.00~"
                                            FontSize="{Binding OtherSettingFontSize}"
                                            Style="{StaticResource StatusRadioButtonStyle}" 
                                            GroupName="Version"
                                            IsHitTestVisible="{Binding RBtnEnable}"
                                            IsChecked="{Binding VersionValue, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Ver400, Mode=TwoWay}" />

                                        <RadioButton 
                                            Grid.Row="2"
                                            Content="~2.98"
                                            FontSize="{Binding OtherSettingFontSize}"
                                            Style="{StaticResource StatusRadioButtonStyle}" 
                                            GroupName="Version"
                                            Margin="0,5,0,0"
                                            VerticalContentAlignment="Center"
                                            IsHitTestVisible="{Binding RBtnEnable}"
                                            IsChecked="{Binding VersionValue, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Ver298, Mode=TwoWay}" />
                                    </Grid>


                                    <!-- ブレークポイント -->
                                    <Grid Grid.Column="1" Margin="0 0 10 0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Label 
                                            Grid.Row="0"
                                            Margin="0 10 0 0"
                                            Content="BP"
                                            Foreground="{DynamicResource AccentBrush}"
                                            FontSize="{Binding TitleFontSize}">
                                        </Label>
                                        <RadioButton
                                            Grid.Row="1"
                                            Content="Invariable"
                                            FontSize="{Binding OtherSettingFontSize}"
                                            Style="{StaticResource StatusRadioButtonStyle}" 
                                            GroupName="BP"
                                            IsHitTestVisible="{Binding RBtnEnable}"
                                            IsChecked="{Binding BPValue, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Invariable, Mode=TwoWay}" />

                                        <RadioButton 
                                            Grid.Row="2"
                                            Content="Variable"
                                            FontSize="{Binding OtherSettingFontSize}"
                                            Style="{StaticResource StatusRadioButtonStyle}" 
                                            GroupName="BP"
                                            Margin="0,5,0,0"
                                            VerticalContentAlignment="Center"
                                            IsHitTestVisible="{Binding RBtnEnable}"
                                            IsChecked="{Binding BPValue, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Variable, Mode=TwoWay}" />
                                    </Grid>

                                    <!-- 上段左：Alerm A -->
                                    <Grid Grid.Column="2" Margin="0 0 10 0">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Label 
                                            Grid.Row="0"
                                            Margin="0 10 0 0"
                                            Content="Increment"
                                            Foreground="{DynamicResource AccentBrush}"
                                            FontSize="{Binding TitleFontSize}">
                                        </Label>
                                        <RadioButton 
                                            Grid.Row="1"
                                            Content="normal"
                                            FontSize="{Binding OtherSettingFontSize}"
                                            Style="{StaticResource StatusRadioButtonStyle}" 
                                            GroupName="Increment"
                                            IsHitTestVisible="{Binding RBtnEnable}"
                                            IsChecked="{Binding IncrementValue, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Normal, Mode=TwoWay}" />

                                        <RadioButton 
                                            Grid.Row="2"
                                            Content="5%"
                                            FontSize="{Binding OtherSettingFontSize}"
                                            Style="{StaticResource StatusRadioButtonStyle}" 
                                            GroupName="Increment"
                                            Margin="0,5,0,0"
                                            VerticalContentAlignment="Center"
                                            IsHitTestVisible="{Binding RBtnEnable}"
                                            IsChecked="{Binding IncrementValue, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=FivePercent, Mode=TwoWay}" />
                                    </Grid>
                                </Grid>
                            </GroupBox>

                            <!-- ▼ Measure グループ -->
                            <GroupBox Grid.Row="0" Grid.Column="3" Margin="5 0 0 0"
                              Style="{StaticResource GroupBoxSmallMarginStyle}"                      
                              Width="{Binding GroupBoxWidth200}">
                                <GroupBox.Header>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock 
                                        Text="Measure Settings" 
                                        Foreground="{DynamicResource AccentBrush}" 
                                        FontSize="{Binding TitleFontSize}" 
                                        FontWeight="Bold"/>
                                    </StackPanel>
                                </GroupBox.Header>

                                <Grid HorizontalAlignment="Left" Margin="0 -15 0 0">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="{Binding UnitTextboxWidth}"/>
                                        <ColumnDefinition Width="10"/>
                                        <ColumnDefinition Width="{Binding UnitTextboxWidth}"/>
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>

                                    <Label 
                                    Grid.Column="0"
                                    Grid.Row="0"
                                    Margin="0 10 0 0"
                                    Content="Interval"
                                    Foreground="{DynamicResource AccentBrush}"
                                    FontSize="{Binding TitleFontSize}">
                                    </Label>

                                    <Grid Grid.Column="0" Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBox 
                                        Grid.Column="0"
                                        Grid.Row="1"
                                        Style="{StaticResource UnderlineTextBoxStyle}" 
                                        Margin="0 -12 0 0"
                                        Text="{Binding IntervalValue, UpdateSourceTrigger=PropertyChanged}"
                                        FontSize="{Binding TitleFontSize}"
                                        IsEnabled="{Binding MSettingEnable}">
                                            <i:Interaction.Behaviors>
                                                <local:PositiveIntegerBehavior MaxValue="1000"/>
                                            </i:Interaction.Behaviors>
                                        </TextBox>

                                        <TextBlock 
                                        Grid.Column="1"
                                        Grid.Row="1"
                                        Text="(Sec)" 
                                        Margin="0 0 0 0"
                                        Foreground="{DynamicResource AccentBrush}" 
                                        FontSize="{Binding UnitFontSize}" 
                                        FontWeight="Bold"/>
                                    </Grid>

                                    <Label
                                    Grid.Row="0"
                                    Grid.Column="2"
                                    Margin="0 10 0 0"
                                    Content="Stable OS"
                                    Foreground="{DynamicResource AccentBrush}"
                                    FontSize="{Binding TitleFontSize}">
                                    </Label>

                                    <Grid Grid.Column="2" Grid.Row="1">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBox
                                        Grid.Column="0"
                                        Grid.Row="0"
                                        Style="{StaticResource UnderlineTextBoxStyle}" 
                                        Margin="0 -12 0 0"
                                        Text="{Binding StableOSValue, UpdateSourceTrigger=PropertyChanged}"
                                        FontSize="{Binding TitleFontSize}"
                                        IsEnabled="{Binding MSettingEnable}">
                                            <i:Interaction.Behaviors>
                                                <local:PositiveIntegerBehavior MaxValue="1000"/>
                                            </i:Interaction.Behaviors>
                                        </TextBox>
                                        <TextBlock 
                                        Grid.Column="1"
                                        Grid.Row="1"
                                        Text="(Sec)" 
                                        Margin="0 0 0 0"
                                        Foreground="{DynamicResource AccentBrush}" 
                                        FontSize="{Binding UnitFontSize}" 
                                        FontWeight="Bold"/>
                                    </Grid>

                                    <Label 
                                    Grid.Column="0"
                                    Grid.Row="2"
                                    Content="Attempts"
                                    Foreground="{DynamicResource AccentBrush}"
                                    FontSize="{Binding TitleFontSize}">
                                    </Label>
                                    <Grid Grid.Column="0" Grid.Row="3">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <TextBox 
                                        Grid.Column="0"
                                        Grid.Row="3"
                                        Style="{StaticResource UnderlineTextBoxStyle}" 
                                        Margin="0 -12 0 0"
                                        Text="{Binding AttemptsValue, UpdateSourceTrigger=PropertyChanged}"
                                        FontSize="{Binding TitleFontSize}"
                                        IsEnabled="{Binding MSettingEnable}">
                                            <i:Interaction.Behaviors>
                                                <local:PositiveIntegerBehavior MaxValue="100"/>
                                            </i:Interaction.Behaviors>
                                        </TextBox>
                                        <TextBlock 
                                        Grid.Column="1"
                                        Grid.Row="1"
                                        Text="(count)" 
                                        Margin="0 0 0 0"
                                        Foreground="{DynamicResource AccentBrush}" 
                                        FontSize="{Binding UnitFontSize}" 
                                        FontWeight="Bold"/>
                                    </Grid>

                                    <Label 
                                    Grid.Column="2"
                                    Grid.Row="2"
                                    Content="Wait OS"
                                    Foreground="{DynamicResource AccentBrush}"
                                    FontSize="{Binding TitleFontSize}">
                                    </Label>
                                    <Grid Grid.Column="2" Grid.Row="3">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>
                                        <TextBox
                                        Grid.Column="0"
                                        Grid.Row="1"
                                        Style="{StaticResource UnderlineTextBoxStyle}" 
                                        Margin="0 -12 0 0"
                                        Text="{Binding WaitOSValue, UpdateSourceTrigger=PropertyChanged}"
                                        FontSize="{Binding TitleFontSize}"
                                        IsEnabled="{Binding MSettingEnable}">
                                            <i:Interaction.Behaviors>
                                                <local:PositiveIntegerBehavior MaxValue="1000"/>
                                            </i:Interaction.Behaviors>
                                        </TextBox>
                                        <TextBlock 
                                        Grid.Column="1"
                                        Grid.Row="1"
                                        Text="(Sec)" 
                                        Margin="0 0 0 0"
                                        Foreground="{DynamicResource AccentBrush}" 
                                        FontSize="{Binding UnitFontSize}" 
                                        FontWeight="Bold"/>
                                    </Grid>
                                </Grid>
                            </GroupBox>
                        </Grid>

                        <!-- 2段目Grid FB -->
                        <Grid Grid.Row="1" HorizontalAlignment="Left" Margin="0 7 0 0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                            </Grid.RowDefinitions>

                            <GroupBox 
                            Grid.Row="1" 
                            Grid.Column="0"
                            Margin="5 0 0 0"
                            Style="{StaticResource GroupBoxSmallMarginStyle}"                                  
                            Width="{Binding GroupBoxWidth700}">
                                <GroupBox.Header>
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="Auto" />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="0" Orientation="Horizontal" 
                                        VerticalAlignment="Center">
                                            <TextBlock 
                                            Text="FB Data" 
                                            Foreground="{DynamicResource AccentBrush}" 
                                            FontSize="{Binding TitleFontSize}" 
                                            FontWeight="Bold"/>

                                        </StackPanel>
                                        <Button
                                        Grid.Column="1"
                                        Style="{StaticResource HoverButtonStyle}"
                                        Background="Transparent"
                                        Foreground="{DynamicResource AccentBrush}"
                                        BorderBrush="{DynamicResource AccentBrush}"
                                        Content="Read"
                                        Width="{Binding MfmBtnSIze}"
                                        Cursor="Hand"
                                        Command="{Binding GainReadWriteCommand}"
                                        CommandParameter="r"
                                        FontSize="{Binding LabelFontSize}"
                                        Margin="15,0,5,0"
                                        HorizontalAlignment="Right"
                                        IsEnabled="{Binding CanReadWriteGain}"
                                        VerticalAlignment="Center" />

                                        <Button 
                                        Grid.Column="2"
                                        Style="{StaticResource HoverButtonStyle}"
                                        Background="Transparent"
                                        Foreground="{DynamicResource AccentBrush}"
                                        BorderBrush="{DynamicResource AccentBrush}"
                                        Content="Write"
                                        Width="{Binding MfmBtnSIze}"
                                        Cursor="Hand"
                                        Command="{Binding GainReadWriteCommand}"
                                        CommandParameter="w"
                                        FontSize="{Binding LabelFontSize}"
                                        Margin="15,0,5,0"
                                        HorizontalAlignment="Right"
                                        IsEnabled="{Binding CanReadWriteGain}"
                                        VerticalAlignment="Center" />

                                    </Grid>
                                </GroupBox.Header>

                                <Grid HorizontalAlignment="Center">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <RowDefinition Height="Auto"/>
                                    </Grid.RowDefinitions>
                                    <!--<Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>-->

                                    <!-- 上位バイト -->
                                    <DataGrid 
                                    x:Name="UpperFBData" 
                                    Grid.Row="0"
                                    Margin="15,5,15,0" 
                                    AlternatingRowBackground="Transparent"
                                    AutoGenerateColumns="False"
                                    BorderBrush="{DynamicResource ButtonThemeColorBrush}"                                          
                                    Background="Transparent"
                                    CanUserAddRows="False"
                                    CanUserDeleteRows="False"
                                    CanUserSortColumns="False"
                                    CanUserReorderColumns="False"
                                    CanUserResizeColumns="False"
                                    CellStyle="{StaticResource TransparentCell}"
                                    ColumnHeaderStyle="{StaticResource TransparentColumnHeader}"
                                    Width="Auto"
                                    FontSize="{Binding DataGridFontSize}"
                                    GridLinesVisibility="None"
                                    HeadersVisibility="Column"
                                    HorizontalAlignment="Stretch"
                                    ColumnWidth="*"
                                    RowBackground="Transparent"
                                    SelectionUnit="Cell">

                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="FB90" Binding="{Binding Fb90}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB92" Binding="{Binding Fb92}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB94" Binding="{Binding Fb94}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB96" Binding="{Binding Fb96}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB98" Binding="{Binding Fb98}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB9A" Binding="{Binding Fb9a}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB9C" Binding="{Binding Fb9c}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB9E" Binding="{Binding Fb9e}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FBA0" Binding="{Binding Fba0}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FBA2" Binding="{Binding Fba2}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB41" Binding="{Binding Fb41}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                        </DataGrid.Columns>
                                    </DataGrid>

                                    <!-- 下位バイト -->
                                    <DataGrid 
                                    x:Name="lowerFBData" 
                                    Grid.Row="1"
                                    Margin="15,0,15,5" 
                                    AlternatingRowBackground="Transparent"
                                    AutoGenerateColumns="False"
                                    BorderBrush="{DynamicResource ButtonThemeColorBrush}"                                          
                                    Background="Transparent"
                                    CanUserAddRows="False"
                                    CanUserDeleteRows="False"
                                    CanUserSortColumns="False"
                                    CanUserReorderColumns="False"
                                    CanUserResizeColumns="False"
                                    CellStyle="{StaticResource TransparentCell}"
                                    ColumnHeaderStyle="{StaticResource TransparentColumnHeader}"
                                    Width="Auto"
                                    FontSize="{Binding DataGridFontSize}"
                                    GridLinesVisibility="None"
                                    HeadersVisibility="Column"
                                    HorizontalAlignment="Stretch"
                                    ColumnWidth="*"
                                    RowBackground="Transparent"
                                    SelectionUnit="Cell">

                                        <DataGrid.Columns>
                                            <DataGridTextColumn Header="FB91" Binding="{Binding Fb91}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB93" Binding="{Binding Fb93}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB95" Binding="{Binding Fb95}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB97" Binding="{Binding Fb97}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB99" Binding="{Binding Fb99}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB9B" Binding="{Binding Fb9b}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB9D" Binding="{Binding Fb9d}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB9F" Binding="{Binding Fb9f}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FBA1" Binding="{Binding Fba1}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FBA3" Binding="{Binding Fba3}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                            <DataGridTextColumn Header="FB42" Binding="{Binding Fb42}" EditingElementStyle="{StaticResource EditingTextBoxStyle}"/>
                                        </DataGrid.Columns>
                                    </DataGrid>
                                </Grid>
                            </GroupBox>
                        </Grid>
                    </Grid>

                    <!-- 2段目Grid MFM, 計測コマンド -->
                    <Grid Grid.Row="1" HorizontalAlignment="Left" Margin="10 5 0 0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- ▼ コマンドグループ -->
                        <GroupBox
                        Grid.Column="0"
                        Style="{StaticResource GroupBoxSmallMarginStyle}"                      
                        Width="{Binding GroupBoxWidth150}"
                        Height="{Binding MiddleGBHeight}">
                            <GroupBox.Header>
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock 
                                    Text="Command" 
                                    Foreground="{DynamicResource AccentBrush}" 
                                    FontSize="{Binding TitleFontSize}" 
                                    FontWeight="Bold"/>

                                </StackPanel>
                            </GroupBox.Header>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Button 
                                Grid.Row="0"
                                Style="{StaticResource HoverButtonStyle}"
                                Background="Transparent"
                                BorderBrush="{DynamicResource AccentBrush}"
                                Command="{Binding CalculateCommand}"
                                CommandParameter="{Binding Calc}"
                                Content="Calculate"  
                                Cursor="Hand"
                                FontSize="{Binding LabelFontSize}"
                                Foreground="{DynamicResource AccentBrush}"
                                HorizontalAlignment="Center"
                                IsEnabled="{Binding CanCalculate}"
                                Margin="0 0 0 5"
                                Width="{Binding CmdBtnSIze}"
                                VerticalAlignment="Center" />
                                <Button 
                                Grid.Row="1"
                                Style="{StaticResource HoverButtonStyle}"
                                Background="Transparent"
                                BorderBrush="{DynamicResource AccentBrush}"
                                Command="{Binding CalculateCommand}"
                                CommandParameter="{Binding Conf}"
                                Content="Conform"  
                                Cursor="Hand"
                                FontSize="{Binding LabelFontSize}"
                                Foreground="{DynamicResource AccentBrush}"
                                HorizontalAlignment="Center"
                                IsEnabled="{Binding CanConform}"
                                Margin="0 0 0 5"
                                Width="{Binding CmdBtnSIze}"
                                VerticalAlignment="Center" />
                                <Button 
                                Grid.Row="2"
                                Style="{StaticResource HoverButtonStyle}"
                                Background="Transparent"
                                BorderBrush="{DynamicResource AccentBrush}"
                                Command="{Binding CalAndConfCommand}"
                                Content="Calc &amp; Conf"  
                                Cursor="Hand"
                                FontSize="{Binding LabelFontSize}"
                                Foreground="{DynamicResource AccentBrush}"
                                HorizontalAlignment="Center"
                                IsEnabled="{Binding CanCalAndConf}"
                                Margin="0 0 0 5"
                                Width="{Binding CmdBtnSIze}"
                                VerticalAlignment="Center" />
                                <Button 
                                Grid.Row="3"
                                Style="{StaticResource HoverButtonStyle}"
                                Background="Transparent"
                                BorderBrush="{DynamicResource AccentBrush}"
                                Command="{Binding ManualCommand}"
                                Content="Manual"  
                                Cursor="Hand"
                                FontSize="{Binding LabelFontSize}"
                                Foreground="{DynamicResource AccentBrush}"
                                HorizontalAlignment="Center"
                                IsEnabled="{Binding CanManual}"
                                Margin="0 0 0 5"
                                Width="{Binding CmdBtnSIze}"
                                VerticalAlignment="Center" />
                                <Button 
                                Grid.Row="4"
                                Style="{StaticResource HoverButtonStyle}"
                                Background="Transparent"
                                BorderBrush="{DynamicResource AccentBrush}"
                                Command="{Binding StopCmdCommand}"
                                Content="Stop"  
                                Cursor="Hand"
                                FontSize="{Binding LabelFontSize}"
                                Foreground="{DynamicResource AccentBrush}"
                                HorizontalAlignment="Center"
                                Margin="0 0 0 0"
                                Width="{Binding CmdBtnSIze}"
                                VerticalAlignment="Center" />
                            </Grid>
                        </GroupBox>

                        <!-- ▼ MFMグループ -->
                        <GroupBox Grid.Column="2" 
                                  Style="{StaticResource GroupBoxSmallMarginStyle}"                      
                                  Width="{Binding GroupBoxWidth500}"
                                  Height="{Binding MiddleGBHeight}">
                            <GroupBox.Header>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="Auto" />
                                        <ColumnDefinition Width="127*"/>
                                        <ColumnDefinition Width="95*"/>
                                    </Grid.ColumnDefinitions>
                                    <StackPanel Grid.Column="0"
                                            Orientation="Horizontal" VerticalAlignment="Center">
                                        <TextBlock Text="MFM" 
                                               Foreground="{DynamicResource AccentBrush}" 
                                               FontSize="{Binding TitleFontSize}" 
                                               FontWeight="Bold"/>
                                    </StackPanel>

                                    <Button 
                                    Grid.Column="1"
                                    Style="{StaticResource HoverButtonStyle}"
                                    Background="Transparent"
                                    Foreground="{DynamicResource AccentBrush}"
                                    BorderBrush="{DynamicResource AccentBrush}"
                                    Content="Execute"
                                    Width="{Binding MfmBtnSIze}"
                                    Cursor="Hand"
                                    Command="{Binding MFMExecuteCommand}"
                                    FontSize="{Binding LabelFontSize}"
                                    Margin="15,0,0,0"
                                    HorizontalAlignment="Left"
                                    IsEnabled="{Binding CanMFM}"
                                    VerticalAlignment="Center" />

                                    <Button 
                                    Grid.Column="2"
                                    Style="{StaticResource HoverButtonStyle}"
                                    Background="Transparent"
                                    Foreground="{DynamicResource AccentBrush}"
                                    BorderBrush="{DynamicResource AccentBrush}"
                                    Content="Stop"
                                    Width="{Binding MfmBtnSIze}"
                                    Cursor="Hand"
                                    Command="{Binding MFMStopCommand}"
                                    FontSize="{Binding LabelFontSize}"
                                    Margin="15,0,0,0"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center" />
                                </Grid>
                            </GroupBox.Header>
                            <Grid Grid.Column="1">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- Zero Adjust -->
                                <GroupBox Grid.Row="0" Grid.Column="0" Margin="5 0 5 5"
                                      Style="{StaticResource GroupBoxSmallMarginStyle}" >
                                    <GroupBox.Header>
                                        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                            <TextBlock 
                                            Text="Zero Adjust" 
                                            Foreground="{DynamicResource AccentBrush}" 
                                            FontSize="{Binding TitleFontSize}" 
                                            FontWeight="Bold"/>
                                        </StackPanel>
                                    </GroupBox.Header>

                                    <Grid Margin="0 10 0 0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <Label
                                            Grid.Column="1"
                                            Grid.Row="0"
                                            Margin="0 0 0 0"
                                            Content="Flow Output"
                                            Foreground="{DynamicResource AccentBrush}"
                                            FontSize="{Binding TitleFontSize}"
                                            HorizontalAlignment="Center">
                                        </Label>
                                        <Border 
                                            Grid.Column="1"
                                            Grid.Row="1"
                                            BorderBrush="{DynamicResource AccentBrush}"
                                            BorderThickness="0 0 0 1.5"                           
                                            HorizontalAlignment="Center"
                                            SnapsToDevicePixels="True"
                                            Margin="0 0 0 5"
                                            Width="{Binding FlowOutputBoxWidth}">
                                            <TextBlock 
                                                Text="{Binding FlowOut}"
                                                Foreground="{DynamicResource AccentBrush}"
                                                FontSize="{Binding TitleFontSize}"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Margin="0 0 0 0"/>
                                        </Border>

                                        <Button
                                            Grid.Column="0"
                                            Grid.Row="0"
                                            Style="{StaticResource HoverButtonStyle}"
                                            Background="Transparent"
                                            Foreground="{DynamicResource AccentBrush}"
                                            BorderBrush="{DynamicResource AccentBrush}"
                                            Content="{Binding ZStext}"
                                            Width="{Binding ZaBtnSIze}"
                                            Cursor="Hand"
                                            Command="{Binding ZeroSendExecuteCommand}"
                                            FontSize="{Binding LabelFontSize}"
                                            Margin="15 0 5 0"
                                            HorizontalAlignment="Center"
                                            IsEnabled="{Binding CanZeroSend}"
                                            VerticalAlignment="Center" />

                                        <Button 
                                        Grid.Column="0"
                                        Grid.Row="1"
                                        Style="{StaticResource HoverButtonStyle}"
                                        Background="Transparent"
                                        Foreground="{DynamicResource AccentBrush}"
                                        BorderBrush="{DynamicResource AccentBrush}"
                                        Content="Zero OK"
                                        Width="{Binding ZaBtnSIze}"
                                        Cursor="Hand"
                                        Command="{Binding ZeroOKExecuteCommand}"
                                        FontSize="{Binding LabelFontSize}"
                                        Margin="15 10 5 0"
                                        HorizontalAlignment="Center"
                                        IsEnabled="{Binding CanZeroOK}"
                                        VerticalAlignment="Center" />
                                    </Grid>
                                </GroupBox>

                                <!-- Span -->
                                <GroupBox Grid.Row="0" Grid.Column="1" Margin="5 0 5 5"
                                      Style="{StaticResource GroupBoxSmallMarginStyle}" Cursor="">
                                    <GroupBox.Header>
                                        <Grid Margin="0 0 0 0">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <TextBlock 
                                            Grid.Column="0"
                                            Margin="0 0 0 0"
                                            Text="Span Adjust" 
                                            Foreground="{DynamicResource AccentBrush}" 
                                            FontSize="{Binding TitleFontSize}" 
                                            FontWeight="Bold"/>

                                            <Button 
                                            Grid.Column="1"
                                            Style="{StaticResource HoverButtonStyle}"
                                            Background="Transparent"
                                            Foreground="{DynamicResource AccentBrush}"
                                            BorderBrush="{DynamicResource AccentBrush}"
                                            Content="Span OK"
                                            Width="{Binding ZaBtnSIze}"
                                            Cursor="Hand"
                                            Command="{Binding SpanOKExecuteCommand}"
                                            FontSize="{Binding LabelFontSize}"
                                            Margin="0 0 0 0"
                                            HorizontalAlignment="Center"
                                            IsEnabled="{Binding CanSpanAdjust}"
                                            VerticalAlignment="Center" />


                                        </Grid>
                                    </GroupBox.Header>
                                    <Grid HorizontalAlignment="Center" VerticalAlignment="Center">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                            <RowDefinition Height="Auto"/>
                                        </Grid.RowDefinitions>

                                        <!-- 上段 -->
                                        <Grid Grid.Row="0" Margin="0 0 0 7">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="*"/>
                                            </Grid.RowDefinitions>

                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Label 
                                                Grid.Column="0"
                                                Content="FB41"
                                                Foreground="{DynamicResource AccentBrush}"
                                                FontSize="{Binding TitleFontSize}">
                                                </Label>

                                                <Border 
                                                Grid.Column="1"
                                                BorderBrush="{DynamicResource AccentBrush}"
                                                BorderThickness="0 0 0 1.5"
                                                HorizontalAlignment="Center"
                                                SnapsToDevicePixels="True"
                                                Margin="0 0 20 5"
                                                Width="{Binding SpanInputWidth}">
                                                    <TextBlock 
                                                    Text="{Binding Fb41Val}"
                                                    Foreground="{DynamicResource AccentBrush}"
                                                    FontSize="{Binding TitleFontSize}"
                                                    HorizontalAlignment="Center"
                                                    Margin="0 0 0 0"/>
                                                </Border>
                                            </Grid>

                                            <Button 
                                            Grid.Column="1"
                                            Style="{StaticResource HoverButtonStyle}"
                                            Background="Transparent"
                                            Foreground="{DynamicResource AccentBrush}"
                                            BorderBrush="{DynamicResource AccentBrush}"
                                            Content="+20"
                                            Margin="0 0 10 0"
                                            Width="{Binding SpanGainSIze}"
                                            Cursor="Hand"
                                            Command="{Binding GainAdjustCommand}"
                                            CommandParameter="20"
                                            FontSize="{Binding LabelFontSize}"
                                            HorizontalAlignment="Center"
                                            IsEnabled="{Binding CanSpanAdjust}"
                                            VerticalAlignment="Center" />

                                            <Button 
                                            Grid.Column="2"
                                            Style="{StaticResource HoverButtonStyle}"
                                            Background="Transparent"
                                            Foreground="{DynamicResource AccentBrush}"
                                            BorderBrush="{DynamicResource AccentBrush}"
                                            Content="+5"
                                            Margin="0 0 10 0"
                                            Width="{Binding SpanGainSIze}"
                                            Cursor="Hand"
                                            Command="{Binding GainAdjustCommand}"
                                            CommandParameter="5"
                                            FontSize="{Binding LabelFontSize}"
                                            HorizontalAlignment="Center"
                                            IsEnabled="{Binding CanSpanAdjust}"
                                            VerticalAlignment="Center" />


                                            <Button 
                                            Grid.Column="3"
                                            Style="{StaticResource HoverButtonStyle}"
                                            Background="Transparent"
                                            Foreground="{DynamicResource AccentBrush}"
                                            BorderBrush="{DynamicResource AccentBrush}"
                                            Content="+1"
                                            Width="{Binding SpanGainSIze}"
                                            Cursor="Hand"
                                            Command="{Binding GainAdjustCommand}"
                                            CommandParameter="1"
                                            FontSize="{Binding LabelFontSize}"
                                            HorizontalAlignment="Center"
                                            IsEnabled="{Binding CanSpanAdjust}"
                                            VerticalAlignment="Center" />
                                        </Grid>

                                        <!-- 下段 -->
                                        <Grid Grid.Row="1">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="*"/>
                                            </Grid.ColumnDefinitions>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="*"/>
                                            </Grid.RowDefinitions>

                                            <Grid Grid.Column="0" Margin="0 0 0 0">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>
                                                <Label 
                                                Grid.Column="0"
                                                Margin="0 0 -1.5 0"
                                                Content="FB42"
                                                Foreground="{DynamicResource AccentBrush}"
                                                FontSize="{Binding TitleFontSize}">
                                                </Label>

                                                <Border 
                                                Grid.Column="1"
                                                BorderBrush="{DynamicResource AccentBrush}"
                                                BorderThickness="0 0 0 1.5"
                                                HorizontalAlignment="Center"
                                                SnapsToDevicePixels="True"
                                                Margin="0 0 20 5"
                                                Width="{Binding SpanInputWidth}">
                                                    <TextBlock 
                                                    Text="{Binding Fb42Val}"
                                                    Foreground="{DynamicResource AccentBrush}"
                                                    FontSize="{Binding TitleFontSize}"
                                                    HorizontalAlignment="Center"
                                                    Margin="0 0 0 0"/>
                                                </Border>
                                            </Grid>
                                            <Button 
                                            Grid.Column="1"
                                            Style="{StaticResource HoverButtonStyle}"
                                            Background="Transparent"
                                            Foreground="{DynamicResource AccentBrush}"
                                            BorderBrush="{DynamicResource AccentBrush}"
                                            Content="-20"
                                            Width="{Binding SpanGainSIze}"
                                            Margin="0 0 10 0"
                                            Cursor="Hand"
                                            Command="{Binding GainAdjustCommand}"
                                            CommandParameter="-20"
                                            FontSize="{Binding LabelFontSize}"
                                            HorizontalAlignment="Center"
                                            IsEnabled="{Binding CanSpanAdjust}"
                                            VerticalAlignment="Center" />

                                            <Button 
                                            Grid.Column="2"
                                            Style="{StaticResource HoverButtonStyle}"
                                            Background="Transparent"
                                            Foreground="{DynamicResource AccentBrush}"
                                            BorderBrush="{DynamicResource AccentBrush}"
                                            Content="-5"
                                            Width="{Binding SpanGainSIze}"
                                            Margin="0 0 10 0"
                                            Cursor="Hand"
                                            Command="{Binding GainAdjustCommand}"
                                            CommandParameter="-5"
                                            FontSize="{Binding LabelFontSize}"
                                            HorizontalAlignment="Center"
                                            IsEnabled="{Binding CanSpanAdjust}"
                                            VerticalAlignment="Center" />

                                            <Button 
                                            Grid.Column="3"
                                            Style="{StaticResource HoverButtonStyle}"
                                            Background="Transparent"
                                            Foreground="{DynamicResource AccentBrush}"
                                            BorderBrush="{DynamicResource AccentBrush}"
                                            Content="-1"
                                            Width="{Binding SpanGainSIze}"
                                            Cursor="Hand"
                                            Command="{Binding GainAdjustCommand}"
                                            CommandParameter="-1"
                                            FontSize="{Binding LabelFontSize}"
                                            HorizontalAlignment="Center"
                                            IsEnabled="{Binding CanSpanAdjust}"
                                            VerticalAlignment="Center" />
                                        </Grid>
                                    </Grid>
                                </GroupBox>
                            </Grid>
                        </GroupBox>
                    </Grid>

                    <!-- 3段目Grid MFM, 計測コマンド -->
                    <Grid Grid.Row="2" HorizontalAlignment="Left" Margin="10 2 0 0">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- ▼ 測定結果グループ -->
                        <GroupBox Grid.Column="0" 
                              Style="{StaticResource GroupBoxSmallMarginStyle}"                      
                              Width="{Binding GroupBoxWidth150}"
                              Height="{Binding GroupBoxHeight250}">
                            <GroupBox.Header>
                                <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                    <TextBlock Text="Measure" 
                                           Foreground="{DynamicResource AccentBrush}" 
                                           FontSize="{Binding TitleFontSize}" 
                                           FontWeight="Bold"/>
                                </StackPanel>
                            </GroupBox.Header>

                            <Grid Margin="2">
                                <!-- 行定義（11行） -->
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- 列定義 -->
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="{Binding MeasureColumNameWidth}"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- ===== Column 0 ===== -->
                                <ItemsControl Grid.Column="0"
                                          ItemsSource="{Binding MesurementItems}"
                                          AlternationCount="11">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Style="{StaticResource MeasureCellBorderStyle}"
                                                Grid.Row="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter},
                                           Path=(ItemsControl.AlternationIndex)}">
                                                <TextBlock Text="{Binding Value}"
                                                        Style="{StaticResource MeasureTextCenterStyle}"/>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- ===== Column 1 ===== -->
                                <ItemsControl Grid.Column="1"
                                          ItemsSource="{Binding MesurementValues}"
                                          AlternationCount="11">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border 
                                                Style="{StaticResource MeasureCellBorderStyle}"
                                                Grid.Row="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter},
                                                    Path=(ItemsControl.AlternationIndex)}">
                                                <TextBlock Text="{Binding Value}"         FontSize="{Binding DataContext.LogFontSize,
                                                    RelativeSource={RelativeSource AncestorType=ItemsControl}}">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="Opacity" Value="1"/>
                                                            <Style.Triggers>

                                                                <!-- 明滅トリガー -->
                                                                <DataTrigger Binding="{Binding IsUpdate}" Value="True">
                                                                    <DataTrigger.EnterActions>
                                                                        <BeginStoryboard x:Name="BlinkStoryboard">
                                                                            <Storyboard>
                                                                                <DoubleAnimation
                                                                                Storyboard.TargetProperty="Opacity"
                                                                                From="1"
                                                                                To="0.3"
                                                                                Duration="0:0:0.25"
                                                                                AutoReverse="True"
                                                                                RepeatBehavior="Forever"/>
                                                                            </Storyboard>
                                                                        </BeginStoryboard>
                                                                    </DataTrigger.EnterActions>

                                                                    <!-- 終了時に確実に元に戻す -->
                                                                    <DataTrigger.ExitActions>
                                                                        <BeginStoryboard>
                                                                            <Storyboard>
                                                                                <DoubleAnimation
                                                                                Storyboard.TargetProperty="Opacity"
                                                                                To="1"
                                                                                Duration="0"/>
                                                                            </Storyboard>
                                                                        </BeginStoryboard>
                                                                    </DataTrigger.ExitActions>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Grid>
                        </GroupBox>

                        <!-- Outputグループ -->
                        <GroupBox Grid.Column="1" 
                              Style="{StaticResource GroupBoxSmallMarginStyle}"
                              Width="{Binding GroupBoxWidth500}"
                              Height="{Binding GroupBoxHeight250}">
                            <GroupBox.Header>
                                <Grid VerticalAlignment="Center">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="Auto"/>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="Auto"/>
                                    </Grid.ColumnDefinitions>
                                    <TextBlock 
                                    Grid.Column="0"
                                    Text="Output" 
                                    Foreground="{DynamicResource AccentBrush}" 
                                    FontSize="{Binding TitleFontSize}" 
                                    FontWeight="Bold"/>
                                    <Button 
                                    Grid.Column="1"
                                    Style="{StaticResource HoverButtonStyle}"
                                    Background="Transparent"
                                    Foreground="{DynamicResource AccentBrush}"
                                    BorderBrush="{DynamicResource AccentBrush}"
                                    Content="Calculate Gain"
                                    Width="{Binding OutputBtnSIze}"
                                    Cursor="Hand"
                                    Command="{Binding CalculateGainCommand}"
                                    FontSize="{Binding LabelFontSize}"
                                    Margin="15,0,5,0"
                                    IsEnabled="{Binding CanCalcGain}"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center" />
                                    <Button 
                                    Grid.Column="2"
                                    Style="{StaticResource HoverButtonStyle}"
                                    Background="Transparent"
                                    Foreground="{DynamicResource AccentBrush}"
                                    BorderBrush="{DynamicResource AccentBrush}"
                                    Content="CSV Export"
                                    Width="{Binding OutputBtnSIze}"
                                    Cursor="Hand"
                                    Command="{Binding ExportParamsToCsvCommand}"
                                    FontSize="{Binding LabelFontSize}"
                                    Margin="15,0,5,0"
                                    IsEnabled="{Binding CanExport}"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center" />
                                </Grid>
                            </GroupBox.Header>
                            <Grid x:Name="RootGrid" Margin="2">
                                <!-- 行定義（11行） -->
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="*"/>
                                </Grid.RowDefinitions>

                                <!-- 列定義 -->
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <Grid.Resources>
                                    <SolidColorBrush x:Key="GlowColorReference1" Color="{DynamicResource TagColor}"/>
                                    <SolidColorBrush x:Key="GlowColorReference2" Color="{DynamicResource CoffButtonGColor}"/>
                                    <LinearGradientBrush x:Key="AnimatedGlowBrush" StartPoint="0,0" EndPoint="1,1">
                                        <GradientStop Color="{Binding Source={StaticResource GlowColorReference1}, Path=Color}" Offset="0"/>
                                        <GradientStop Color="{Binding Source={StaticResource GlowColorReference2}, Path=Color}" Offset="0.5"/>
                                        <GradientStop Color="{Binding Source={StaticResource GlowColorReference1}, Path=Color}" Offset="1"/>
                                    </LinearGradientBrush>
                                </Grid.Resources>

                                <!-- ===== Column 0 Set Point ===== -->
                                <ItemsControl Grid.Column="0"
                                          ItemsSource="{Binding SetPointArray}"
                                          AlternationCount="11">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Style="{StaticResource MeasureCellBorderStyle}"
                                                Grid.Row="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter},
                                                Path=(ItemsControl.AlternationIndex)}">
                                                <TextBlock Text="{Binding}">
                                                    <TextBlock.Style>
                                                        <Style TargetType="TextBlock" BasedOn="{StaticResource MeasureTextLeftStyle_WithFirstRowCenter}">
                                                            <Style.Triggers>
                                                                <DataTrigger Value="True">
                                                                    <DataTrigger.Binding>
                                                                        <MultiBinding Converter="{StaticResource EqualityConverter}">
                                                                            <Binding Path="DataContext.ConfIndex" 
                                                                                     RelativeSource="{RelativeSource AncestorType=ItemsControl}"/>
                                                                            <Binding Path="(ItemsControl.AlternationIndex)" 
                                                                                     RelativeSource="{RelativeSource AncestorType=ContentPresenter}"/>
                                                                        </MultiBinding>
                                                                    </DataTrigger.Binding>

                                                                    <Setter Property="Foreground" Value="{DynamicResource AnimatedGlowBrush}"/>

                                                                    <DataTrigger.EnterActions>
                                                                        <BeginStoryboard Name="GlowAnim">
                                                                            <Storyboard RepeatBehavior="Forever">
                                                                                <DoubleAnimation 
                                                                                    Storyboard.TargetProperty="Foreground.(LinearGradientBrush.GradientStops)[0].Offset"
                                                                                    From="-0.8" To="2.2" Duration="0:0:2.5"/>

                                                                                <DoubleAnimation 
                                                                                    Storyboard.TargetProperty="Foreground.(LinearGradientBrush.GradientStops)[1].Offset"
                                                                                    From="-0.5" To="2.5" Duration="0:0:2.5"/>

                                                                                <DoubleAnimation 
                                                                                    Storyboard.TargetProperty="Foreground.(LinearGradientBrush.GradientStops)[2].Offset"
                                                                                    From="-0.2" To="2.8" Duration="0:0:2.5"/>
                                                                            </Storyboard>
                                                                        </BeginStoryboard>
                                                                    </DataTrigger.EnterActions>
                                                                </DataTrigger>
                                                            </Style.Triggers>
                                                        </Style>
                                                    </TextBlock.Style>
                                                </TextBlock>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- ===== Column 1 True ===== -->
                                <ItemsControl Grid.Column="1"
                                          ItemsSource="{Binding TrueValueArray}"
                                          AlternationCount="11">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Style="{StaticResource MeasureCellBorderStyle}"
                                                Grid.Row="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter},
                                           Path=(ItemsControl.AlternationIndex)}">
                                                <TextBlock Text="{Binding}"
                                                        Style="{StaticResource MeasureTextLeftStyle_WithFirstRowCenter}"/>

                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- ===== Column 2 Reading ===== -->
                                <ItemsControl Grid.Column="2"
                                          ItemsSource="{Binding ReadingValueArray}"
                                          AlternationCount="11">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Style="{StaticResource MeasureCellBorderStyle}"
                                                Grid.Row="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter}, Path=(ItemsControl.AlternationIndex)}">
                                                <TextBox  
                                                Text="{Binding Value, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                Background ="Transparent"
                                                HorizontalAlignment="Stretch"
                                                VerticalAlignment="Stretch"
                                                BorderThickness="0"
                                                Foreground="{DynamicResource AccentBrush}"
                                                Padding="0"

                                                IsReadOnly="{Binding DataContext.CanEditReadingList,
                                                    RelativeSource={RelativeSource AncestorType=ItemsControl},
                                                    Converter={StaticResource InverseBoolConverter},Mode=OneWay}"                                                         
                                                Style="{StaticResource MeasureTextBoxLeftStyle_WithFirstRowCenter}">
                                                    <i:Interaction.Behaviors>
                                                        <local:FpNumberBehavior MaxValue="100000.0" MinValue="0.0"/>
                                                    </i:Interaction.Behaviors>
                                                </TextBox>
                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- ===== Column 3 初期VO ===== -->
                                <ItemsControl Grid.Column="3"
                                          ItemsSource="{Binding InitialVoArray}"
                                          AlternationCount="11">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Style="{StaticResource MeasureCellBorderStyle}"
                                                Grid.Row="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter},
                                           Path=(ItemsControl.AlternationIndex)}">
                                                <TextBlock Text="{Binding}"
                                                        Style="{StaticResource MeasureTextLeftStyle_WithFirstRowCenter}"/>

                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- ===== Column 4 補正Data ===== -->
                                <ItemsControl Grid.Column="4"
                                          ItemsSource="{Binding CorrectDataArray}"
                                          AlternationCount="11">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Style="{StaticResource MeasureCellBorderStyle}"
                                                Grid.Row="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter},
                                           Path=(ItemsControl.AlternationIndex)}">
                                                <TextBlock Text="{Binding}"
                                                        Style="{StaticResource MeasureTextLeftStyle_WithFirstRowCenter}"/>

                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- ===== Column 5 VOUT ===== -->
                                <ItemsControl Grid.Column="5"
                                          ItemsSource="{Binding VoutArray}"
                                          AlternationCount="11">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Style="{StaticResource MeasureCellBorderStyle}"
                                                Grid.Row="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter},
                                           Path=(ItemsControl.AlternationIndex)}">
                                                <TextBlock Text="{Binding}"
                                                        Style="{StaticResource MeasureTextLeftStyle_WithFirstRowCenter}"/>

                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- ===== Column 6 VO ===== -->
                                <ItemsControl Grid.Column="6"
                                          ItemsSource="{Binding VOArray}"
                                          AlternationCount="11">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Border Style="{StaticResource MeasureCellBorderStyle}"
                                                Grid.Row="{Binding RelativeSource={RelativeSource AncestorType=ContentPresenter},
                                           Path=(ItemsControl.AlternationIndex)}">
                                                <TextBlock Text="{Binding}"
                                                        Style="{StaticResource MeasureTextLeftStyle_WithFirstRowCenter}"/>

                                            </Border>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>

                                <!-- ===== Column 7 ===== -->
                                <Grid Grid.Column="7">

                                    <!-- 全体を 11 行に分割 -->
                                    <Grid.RowDefinitions>
                                        <!-- 0行目 -->
                                        <RowDefinition Height="Auto"/>

                                        <!-- 1〜10行目 -->
                                        <RowDefinition Height="*"/>
                                    </Grid.RowDefinitions>

                                    <!-- ================= -->
                                    <!-- Row 0 : 表示のみ -->
                                    <!-- ================= -->
                                    <Border Grid.Row="0"
                                        Style="{StaticResource MeasureCellBorderStyle}">
                                        
                                        <TextBlock Text="{Binding ConfirmArray[0]}"
                                                   FontSize="{Binding DataContext.LogFontSize,
                                                    RelativeSource={RelativeSource AncestorType=Border}}"
                                                Style="{StaticResource MeasureTextLeftStyle_WithFirstRowCenter}"/>
                                    </Border>

                                    <!-- =========================== -->
                                    <!-- Row 1 : 10 個のボタン領域 -->
                                    <!-- =========================== -->
                                    <Grid Grid.Row="1">

                                        <!-- 10 等分 -->
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="{Binding ConfHeightSize}"/>
                                            <RowDefinition Height="{Binding ConfHeightSize}"/>
                                            <RowDefinition Height="{Binding ConfHeightSize}"/>
                                            <RowDefinition Height="{Binding ConfHeightSize}"/>
                                            <RowDefinition Height="{Binding ConfHeightSize}"/>
                                            <RowDefinition Height="{Binding ConfHeightSize}"/>
                                            <RowDefinition Height="{Binding ConfHeightSize}"/>
                                            <RowDefinition Height="{Binding ConfHeightSize}"/>
                                            <RowDefinition Height="{Binding ConfHeightSize}"/>
                                            <RowDefinition Height="{Binding ConfHeightSize}"/>
                                        </Grid.RowDefinitions>

                                        <!-- ===== ボタン 1〜10 ===== -->
                                        <Border Grid.Row="0" Style="{StaticResource MeasureCellBorderStyle}">
                                            <Button Content="Conf 1" 
                                                FontSize="{Binding ConfBtnFontSize}"
                                                VerticalContentAlignment="Center"
                                                Style="{StaticResource ConfirmButtonStyle}"
                                                Command="{Binding ManualChangeSetpointCommand}"
                                                CommandParameter="1"
                                                IsEnabled="{Binding CanConfAlone}"
                                                Foreground="{DynamicResource AccentBrush}"
                                                BorderBrush="{DynamicResource AccentBrush}"
                                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Cursor="Hand"/>
                                        </Border>

                                        <Border Grid.Row="1" Style="{StaticResource MeasureCellBorderStyle}">
                                            <Button Content="Conf 2" 
                                                FontSize="{Binding ConfBtnFontSize}"
                                                Style="{StaticResource ConfirmButtonStyle}"
                                                Command="{Binding ManualChangeSetpointCommand}"
                                                CommandParameter="2"
                                                IsEnabled="{Binding CanConfAlone}"
                                                Foreground="{DynamicResource AccentBrush}"
                                                BorderBrush="{DynamicResource AccentBrush}"
                                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Cursor="Hand"/>
                                        </Border>

                                        <Border Grid.Row="2" Style="{StaticResource MeasureCellBorderStyle}">
                                            <Button Content="Conf 3" 
                                                FontSize="{Binding ConfBtnFontSize}"
                                                Style="{StaticResource ConfirmButtonStyle}"
                                                Command="{Binding ManualChangeSetpointCommand}"
                                                CommandParameter="3"
                                                IsEnabled="{Binding CanConfAlone}"
                                                Foreground="{DynamicResource AccentBrush}"
                                                BorderBrush="{DynamicResource AccentBrush}"
                                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Cursor="Hand"/>
                                        </Border>

                                        <Border Grid.Row="3" Style="{StaticResource MeasureCellBorderStyle}">
                                            <Button Content="Conf 4" 
                                                FontSize="{Binding ConfBtnFontSize}"
                                                Style="{StaticResource ConfirmButtonStyle}"
                                                Command="{Binding ManualChangeSetpointCommand}"
                                                CommandParameter="4"        
                                                IsEnabled="{Binding CanConfAlone}"
                                                Foreground="{DynamicResource AccentBrush}"
                                                BorderBrush="{DynamicResource AccentBrush}"
                                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Cursor="Hand"/>
                                        </Border>

                                        <Border Grid.Row="4" Style="{StaticResource MeasureCellBorderStyle}">
                                            <Button Content="Conf 5" 
                                                FontSize="{Binding ConfBtnFontSize}"
                                                Style="{StaticResource ConfirmButtonStyle}"
                                                Command="{Binding ManualChangeSetpointCommand}"
                                                CommandParameter="5"      
                                                IsEnabled="{Binding CanConfAlone}"
                                                Foreground="{DynamicResource AccentBrush}"
                                                BorderBrush="{DynamicResource AccentBrush}"
                                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Cursor="Hand"/>
                                        </Border>

                                        <Border Grid.Row="5" Style="{StaticResource MeasureCellBorderStyle}">
                                            <Button Content="Conf 6" 
                                                FontSize="{Binding ConfBtnFontSize}"
                                                Style="{StaticResource ConfirmButtonStyle}"
                                                Command="{Binding ManualChangeSetpointCommand}"
                                                CommandParameter="6"      
                                                IsEnabled="{Binding CanConfAlone}"
                                                Foreground="{DynamicResource AccentBrush}"
                                                BorderBrush="{DynamicResource AccentBrush}"
                                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Cursor="Hand"/>
                                        </Border>

                                        <Border Grid.Row="6" Style="{StaticResource MeasureCellBorderStyle}">
                                            <Button Content="Conf 7" 
                                                FontSize="{Binding ConfBtnFontSize}"
                                                Style="{StaticResource ConfirmButtonStyle}"
                                                Command="{Binding ManualChangeSetpointCommand}"
                                                CommandParameter="7"        
                                                IsEnabled="{Binding CanConfAlone}"
                                                Foreground="{DynamicResource AccentBrush}"
                                                BorderBrush="{DynamicResource AccentBrush}"
                                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Cursor="Hand"/>
                                        </Border>

                                        <Border Grid.Row="7" Style="{StaticResource MeasureCellBorderStyle}">
                                            <Button Content="Conf 8" 
                                                FontSize="{Binding ConfBtnFontSize}"
                                                Style="{StaticResource ConfirmButtonStyle}"
                                                Command="{Binding ManualChangeSetpointCommand}"
                                                CommandParameter="8"       
                                                IsEnabled="{Binding CanConfAlone}"
                                                Foreground="{DynamicResource AccentBrush}"
                                                BorderBrush="{DynamicResource AccentBrush}"
                                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Cursor="Hand"/>
                                        </Border>

                                        <Border Grid.Row="8" Style="{StaticResource MeasureCellBorderStyle}">
                                            <Button Content="Conf 9" 
                                                FontSize="{Binding ConfBtnFontSize}"
                                                Style="{StaticResource ConfirmButtonStyle}"
                                                Command="{Binding ManualChangeSetpointCommand}"
                                                CommandParameter="9"          
                                                IsEnabled="{Binding CanConfAlone}"
                                                Foreground="{DynamicResource AccentBrush}"
                                                BorderBrush="{DynamicResource AccentBrush}"
                                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch" Cursor="Hand"/>
                                        </Border>

                                        <Border Grid.Row="9" Style="{StaticResource MeasureCellBorderStyle}">
                                            <Button Content="Conf 10" 
                                                FontSize="{Binding ConfBtnFontSize}"
                                                Style="{StaticResource ConfirmButtonStyle}"
                                                Command="{Binding ManualChangeSetpointCommand}"
                                                CommandParameter="10"        
                                                IsEnabled="{Binding CanConfAlone}"
                                                Foreground="{DynamicResource AccentBrush}"
                                                BorderBrush="{DynamicResource AccentBrush}"
                                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch"/>
                                        </Border>
                                    </Grid>
                                </Grid>
                            </Grid>
                        </GroupBox>
                    </Grid>
                </Grid>
                <Grid Grid.Column="1" Margin="10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="{Binding LogHeightSize}"/>
                    </Grid.RowDefinitions>

                    <!-- ▼ ロググループ -->
                    <GroupBox 
                        Style="{StaticResource LogGroupBoxStyle}"
                        Width="{Binding GroupBoxWidth245}"
                        Height="{Binding LogHeightSize}">

                        <GroupBox.Header>
                            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                <TextBlock 
                                    Text="Log"
                                    Foreground="{DynamicResource AccentBrush}"
                                    FontSize="{Binding TitleFontSize}"
                                    FontWeight="Bold"/>
                            </StackPanel>
                        </GroupBox.Header>

                        <Grid>
                            <Grid.RowDefinitions>
                                <!-- ★ Auto → * に変更（最重要） -->
                                <RowDefinition Height="*" />
                            </Grid.RowDefinitions>

                            <ListBox x:Name="LogListBox"
                                 ItemsSource="{Binding Logs}"
                                 Foreground="{DynamicResource AccentBrush}"
                                 Background="Transparent"
                                 BorderThickness="0"
                                 FontFamily="Consolas"
                                 FontSize="{Binding LogFontSize}"
                                 ScrollViewer.VerticalScrollBarVisibility="Auto"
                                 ScrollViewer.HorizontalScrollBarVisibility="Disabled">

                                <ListBox.ItemsPanel>
                                    <ItemsPanelTemplate>
                                        <VirtualizingStackPanel />
                                    </ItemsPanelTemplate>
                                </ListBox.ItemsPanel>

                            </ListBox>
                        </Grid>
                    </GroupBox>
                </Grid>

            </Grid>
        </ScrollViewer>

        <!-- 右下隅矩形（ScrollBar 表示に連動） -->
        <Border x:Name="ScrollCorner"
                Width="{x:Static SystemParameters.VerticalScrollBarWidth}"
                Height="{x:Static SystemParameters.HorizontalScrollBarHeight}"
                Background="{DynamicResource LeftWindowColor2Brush}"
                BorderBrush="{DynamicResource AccentBrush}"
                BorderThickness="1"
                HorizontalAlignment="Right"
                VerticalAlignment="Bottom"
                Visibility="Collapsed"/>

    </Grid>
</UserControl>